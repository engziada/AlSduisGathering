{% extends 'master.html' %}

{% block content %}
  <h2>السحب العشوائي</h2>
  <form method="post">
  </form>



    <!-- randomize -->
    <div class="slot-machine">
      <div class="slot">
        <div class="number">0</div>
        <div class="number">1</div>
        <div class="number">2</div>
        <div class="number">3</div>
        <div class="number">4</div>
        <div class="number">5</div>
        <div class="number">6</div>
        <div class="number">7</div>
        <div class="number">8</div>
        <div class="number">9</div>
      </div>
      <div class="slot">
        <div class="number">0</div>
        <div class="number">1</div>
        <div class="number">2</div>
        <div class="number">3</div>
        <div class="number">4</div>
        <div class="number">5</div>
        <div class="number">6</div>
        <div class="number">7</div>
        <div class="number">8</div>
        <div class="number">9</div>
      </div>      
      <div class="slot">
        <div class="number">0</div>
        <div class="number">1</div>
        <div class="number">2</div>
        <div class="number">3</div>
        <div class="number">4</div>
        <div class="number">5</div>
        <div class="number">6</div>
        <div class="number">7</div>
        <div class="number">8</div>
        <div class="number">9</div>
    </div>
  </div>
  <button id="spinButton">Spin</button>

  <a href="{{ url_for('list_prizes') }}" class="btn btn-secondary mt-3">العودة لصفحة الهدايا</a>
{% endblock %}

{% block scripts%}
    <script>
      function spin() {
        // Get all the slot elements on the page
        const slots = document.getElementsByClassName('slot');
    
        Array.from(slots).forEach(slot => {
            // Get all the numbers in the slot
            const numbers = slot.getElementsByClassName('number');
            let counter = 0;
            const rotations = 5; // Fixed number of rotations
    
            const spinInterval = setInterval(() => {
                counter += 1;
    
                if (counter < rotations) {
                    Array.from(numbers).forEach(number => {
                        // Redraw slots by changing the inner content
                        number.innerHTML = Math.floor(Math.random() * 10); // Random number between 0 and 9
                    });
                }
    
                if (counter === rotations) {
                    Array.from(numbers).forEach(number => {
                        if (number.classList.contains('selected')) {
                            // Show the selected number and hide others
                            number.style.display = 'block';
                        } else {
                            // Hide other numbers
                            number.style.display = 'none';
                        }
                    });
                    clearInterval(spinInterval); // Stop the spin animation
                }
            }, 100);
        });
    }
    
    document.getElementById('spinButton').addEventListener('click', spin);
                
      /*
        // Randomize
        //const randomizeButton = document.querySelector('#randomizeButton');
        const titletext = document.querySelector('#titletext');

        function shuffleNumbers() {

          const sm2= document.querySelector('#machine2');
          const sm1= document.querySelector('#machine1');
          const sm0= document.querySelector('#machine0');

          // Disable the button
          //randomizeButton.disabled = true;

          // Make an AJAX request to the Flask route
          fetch('/shuffle_numbers') // Replace '/shuffle_numbers' with your Flask route
              .then(response => {
                  if (response.ok) {
                      return response.json();
                  }
                  throw new Error('Network response was not ok.');
              })
              .then(data => {
                  let reg_no = data.message.toString();  // Convert the response to a string
                  alert('رقم الفائز هو : ' + reg_no);
                  titletext.innerHTML = 'رقم الفائز هو : ' + parseInt(reg_no[0])+','+parseInt(reg_no[1])+','+parseInt(reg_no[2]);
                  let slotMachine0 = new SlotMachine(sm0, { active: parseInt(reg_no[0]), auto:true });
                  let slotMachine1 = new SlotMachine(sm1, { active: parseInt(reg_no[1]), auto:true });
                  let slotMachine2 = new SlotMachine(sm2, { active: parseInt(reg_no[2]), auto:true });
                  
                  // Process response data (if any)
                  console.log('Response from Flask:', data);
                  setTimeout(() => slotMachine0.shuffle(5), 100);
                  setTimeout(() => slotMachine1.shuffle(5), 500);
                  setTimeout(() => slotMachine2.shuffle(5), 1000);
      
              })
              .catch(error => {
                  console.error('There was a problem with the fetch operation:', error);
              });

          // Enable the button
          //randomizeButton.disabled = false;
      }
    */

    </script>

{% endblock %}