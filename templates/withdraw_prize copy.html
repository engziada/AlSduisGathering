{% extends 'master.html' %}

{% block content %}
  <h2>السحب العشوائي</h2>
  <form method="post">
  </form>



    <!-- randomize -->
  <div class="d-flex align-items-center" style="height: 200px;">
    <button type="button" id="randomizeButton" class="btn btn-danger btn-lg text-center mx-auto" onclick="shuffleNumbers()">إختيار الفائز</button>
    <h4 id="titletext">رقم الفائز هو : </h4>
    <div id="randomize" class="text-center mx-auto">
      <div class="container">  
        <div class="row">
          <div class="col-1">
            <div class="randomize__item">
              <div id="machine0" class="randomizeMachine">
                <div><a>0</a></div>
                <div><a>1</a></div>
                <div><a>2</a></div>
                <div><a>3</a></div>
                <div><a>4</a></div>
                <div><a>5</a></div>
                <div><a>6</a></div>
                <div><a>7</a></div>
                <div><a>8</a></div>
                <div><a>9</a></div>
              </div>
            </div>
          </div>

          <div class="col-1">
            <div class="randomize__item">
              <div id="machine1" class="randomizeMachine">
                <div><a>0</a></div>
                <div><a>1</a></div>
                <div><a>2</a></div>
                <div><a>3</a></div>
                <div><a>4</a></div>
                <div><a>5</a></div>
                <div><a>6</a></div>
                <div><a>7</a></div>
                <div><a>8</a></div>
                <div><a>9</a></div>
              </div>
            </div>
          </div>

          <div class="col">
            <div class="randomize__item">
              <div id="machine2" class="randomizeMachine">
                <div>0</div>
                <div>1</div>
                <div>2</div>
                <div>3</div>
                <div>4</div>
                <div>5</div>
                <div>6</div>
                <div>7</div>
                <div>8</div>
                <div>9</div>
              </div>
            </div>
          </div>
        </div>
      </div>
    </div>
  </div>
  <a href="{{ url_for('list_prizes') }}" class="btn btn-secondary mt-3">العودة لصفحة الهدايا</a>
{% endblock %}

{% block scripts%}
    <script>
        // Randomize
        //const randomizeButton = document.querySelector('#randomizeButton');
        const titletext = document.querySelector('#titletext');

        function shuffleNumbers() {

          const sm2= document.querySelector('#machine2');
          const sm1= document.querySelector('#machine1');
          const sm0= document.querySelector('#machine0');

          // Disable the button
          //randomizeButton.disabled = true;

          // Make an AJAX request to the Flask route
          fetch('/shuffle_numbers') // Replace '/shuffle_numbers' with your Flask route
              .then(response => {
                  if (response.ok) {
                      return response.json();
                  }
                  throw new Error('Network response was not ok.');
              })
              .then(data => {
                  let reg_no = data.message.toString();  // Convert the response to a string
                  alert('رقم الفائز هو : ' + reg_no);
                  titletext.innerHTML = 'رقم الفائز هو : ' + parseInt(reg_no[0])+','+parseInt(reg_no[1])+','+parseInt(reg_no[2]);
                  let slotMachine0 = new SlotMachine(sm0, { active: parseInt(reg_no[0]), auto:true });
                  let slotMachine1 = new SlotMachine(sm1, { active: parseInt(reg_no[1]), auto:true });
                  let slotMachine2 = new SlotMachine(sm2, { active: parseInt(reg_no[2]), auto:true });
                  
                  // Process response data (if any)
                  console.log('Response from Flask:', data);
                  setTimeout(() => slotMachine0.shuffle(5), 100);
                  setTimeout(() => slotMachine1.shuffle(5), 500);
                  setTimeout(() => slotMachine2.shuffle(5), 1000);
      
              })
              .catch(error => {
                  console.error('There was a problem with the fetch operation:', error);
              });

          // Enable the button
          //randomizeButton.disabled = false;
      }
      

    </script>

{% endblock %}