# نظام تسجيل لقاء أسرة السديس

## مسارات النظام (Routes)

### مسارات التسجيل
- `/` (GET, POST) - الصفحة الرئيسية وبداية التسجيل
  - التحقق من وجود رقم الجوال في قائمة المدعوين
  - التحقق من عدم وجود تسجيل سابق
- `/register/<phone_number>` (GET, POST) - نموذج التسجيل
  - يتم التحقق من صلاحية رقم الجوال
  - التحقق من عدم وجود تسجيل سابق
  - إمكانية تسجيل الأطفال المصاحبين للنساء
- `/registered/<phone_number>` (POST, GET) - تأكيد التسجيل وعرض البيانات
  - عرض بيانات التسجيل
  - إمكانية تعديل أو حذف التسجيل
- `/delete/<phone_number>` (POST) - حذف التسجيل
  - حذف التسجيل وجميع الأطفال المرتبطين به
  - يتطلب تأكيد قبل الحذف
- `/convert_to_image` (POST) - تحويل البيانات إلى صورة

### مسارات لوحة التحكم (تتطلب تسجيل دخول المشرف)
- `/admin` (GET, POST) - لوحة تحكم المشرف
  - إدارة حالة التسجيل (مفتوح/مغلق)
  - عرض إحصائيات التسجيل
- `/delete_guest/<guest_phoneno>` (GET, POST) - حذف ضيف
- `/export` - تصدير البيانات إلى ملف Excel
  - تصدير بيانات المسجلين
  - تصدير بيانات الأطفال
- `/backup_db` - نسخ احتياطي لقاعدة البيانات
- `/upload/` (GET, POST) - رفع ملف
- `/restore_db` - استعادة قاعدة البيانات من النسخة الاحتياطية

### مسارات إدارة الجوائز (تتطلب تسجيل دخول المشرف)
- `/prizes` (GET, POST) - عرض قائمة الجوائز
- `/prizes/add` (GET, POST) - إضافة جائزة جديدة
- `/prizes/edit/<id>` (GET, POST) - تعديل جائزة
- `/prizes/delete/<id>` (POST) - حذف جائزة
- `/prizes/reset/<id>` (POST) - إعادة تعيين جائزة

### مسارات السحب على الجوائز (تتطلب تسجيل دخول المشرف)
- `/withdraw_prize` (GET, POST) - سحب الجوائز
- `/shuffle_numbers/<id>` (GET, POST) - خلط أرقام التسجيل
- `/confirm_prize/<prize_id>/<reg_no>` (GET, POST) - تأكيد الفائز بالجائزة

### مسارات تأكيد الحضور
- `/confirm_attendence` (GET, POST) - تأكيد الحضور

### مسارات البطاقات
- `/cards` - عرض البطاقات
- `/downloadcard1` (POST) - تحميل البطاقة الأولى
- `/downloadcard2` (POST) - تحميل البطاقة الثانية

## المميزات الرئيسية
- تسجيل الحضور مع البيانات الكاملة
- تسجيل الأطفال المصاحبين للنساء
- نظام سحب على الجوائز (للضيوف فقط)
- تصدير بيانات الضيوف والأطفال إلى Excel
- نظام نسخ احتياطي واستعادة
- إدارة كاملة للجوائز والسحوبات
- توليد وتحميل البطاقات
- نظام أمان متكامل للمشرفين
- التحقق المزدوج من صحة البيانات
- نظام تذاكر متكامل مع QR code للحضور
- خيارات متعددة لحفظ التذكرة (طباعة، PDF، صورة)

## Checkpoints
### Checkpoint 1 (2024-12-24)
- إضافة نظام التذاكر المتكامل
- دعم QR code لتأكيد الحضور
- إضافة خيارات حفظ التذكرة (طباعة، PDF، صورة)
- تحسين تصميم التذكرة وإضافة الشعار
- إضافة تصدير بيانات الأطفال في لوحة التحكم
- التأكد من عدم دخول الأطفال في نظام السحب على الجوائز

### Checkpoint 2 (2024-12-25)
- إزالة التحقق من جدول Google Spreadsheet للتسجيل المباشر
- تحديث تصميم تذكرة الحضور بالتواريخ والأوقات الجديدة
- تحسين تصميم الفوتر وإضافة شعار Z Solutions
- إضافة خاصية الفوتر المرن (يثبت في أسفل الشاشة عند قصر المحتوى)
- تحسين المظهر العام للتطبيق وإضافة هوامش متناسقة

## متطلبات النظام
- Python 3.8+
- Flask
- SQLAlchemy
- وباقي المتطلبات موجودة في ملف requirements.txt

## الميزات الأمنية
- حماية جميع مسارات المشرف بنظام تسجيل الدخول
- التحقق المزدوج من صحة رقم الجوال
- حماية عمليات الحذف والتعديل
- نظام النسخ الاحتياطي التلقائي
- التحقق من صحة البيانات قبل الإدخال
- حماية من هجمات CSRF
- تشفير جلسات المستخدم

## طريقة التشغيل
1. تثبيت المتطلبات: `pip install -r requirements.txt`
2. تشغيل السيرفر: `python app.py`
3. فتح المتصفح على: `http://localhost:5000`

## ملاحظات هامة
- يجب التأكد من وجود مجلد `backup` لعمل النسخ الاحتياطي
- يجب التأكد من صلاحيات الوصول لقاعدة البيانات
- يتم تخزين سجلات النظام في مجلد `logs`
- يجب تعيين كلمة مرور المشرف قبل التشغيل